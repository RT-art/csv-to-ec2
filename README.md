# Jsonを編集するだけで、サーバレスでEC2が構築されるAWS SAMデモ

S3にアップロードされたJSONファイルに基づき、既存のVPCとサブネットにEC2インスタンスを自動で作成します。

## アーキテクチャ

![アーキテクチャ図](images/アーキテクチャ図.png)
*(注: 図中のVPCとSubnetは、このスタックによって作成されるのではなく、既存のリソースを利用します)*

## 特徴

- **柔軟なデプロイ**: `sam deploy`時に任意の既存VPCとサブネットを指定できるため、既存のインフラ環境へ簡単に統合できます。
- **インスタンスごとの設定**: 作成したいEC2の情報をJSONファイルで管理します。インスタンスごとにサブネットを指定したり、SSM（セッションマネージャー）の有効/無効を切り替えたりすることが可能です。
- **インフラとアプリの分離**: VPCなどのネットワークインフラの管理と、EC2を作成するアプリケーションのロジックが分離されており、それぞれを独立して管理・更新できます。

## 使い方

1.  **デプロイ**

    下記のコマンドでAWSリソースをデプロイします。
    `--guided` オプションを付けると、対話形式でパラメータの入力を求められます。`VpcId` と `SubnetIds` に、EC2を作成したい既存のVPC IDとサブネットID（カンマ区切り）を入力してください。

    コマンド実行後、Outputとして表示される `S3BucketName` の値を控えてください。

    ```bash
    sam build
    sam deploy --guided
    ```

2.  **JSONファイルのアップロード**

    `sample.json` を参考に、作成したいEC2の情報を記載したJSONファイルを用意します。
    **`ami_id`、`instance_type`、`subnet_id` のキーは必須です。** `enable_ssm` は任意です。

    用意したJSONファイルを、手順1で控えたS3バケットにアップロードします。

    ```bash
    # <S3BucketName> を実際の名前に置き換えてください
    aws s3 cp sample.json s3://<S3BucketName>/
    ```

    アップロード後、CloudWatch LogsでLambdaの実行ログを確認すると、EC2インスタンスが自動で作成される様子がわかります。

3.  **クリーンアップ**

    作成したリソースをすべて削除するには、以下のコマンドを実行します。（作成されたEC2インスタンスは手動で削除する必要があります）

    ```bash
    sam delete
